<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Removes elements from MUSE XML files.">
<title>Remove PHI from MUSE XML files • musePHI</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Remove PHI from MUSE XML files">
<meta property="og:description" content="Removes elements from MUSE XML files.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">musePHI</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/overdodactyl/musePHI/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="musephi">musePHI<a class="anchor" aria-label="anchor" href="#musephi"></a>
</h1></div>
<!-- badges: start -->

<p><code>musePHI</code> is a package designed to assist in the de-identification of MUSE ECG XML files. It enables users to replace sensitive patient information within XML files with placeholders, maintaining the overall structure of the files. This approach helps in ensuring patient privacy while allowing the data to be used for research or analysis purposes.</p>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>It is the responsibility of the user to accurately identify and replace values that need to be de-identified from the XML file. Furthermore, users must validate the results to ensure no personal health information (PHI) is inadvertently disclosed. The developers of <code>musePHI</code> assume no liability for the misuse of this software or the inadvertent sharing of PHI.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of musePHI from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"overdodactyl/musePHI"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://overdodactyl.github.io/musePHI" class="external-link">musePHI</a></span><span class="op">)</span></span></code></pre></div>
<p>The function takes an input XML file, an output file path, and a list of replacement patterns. Each replacement pattern is applied to the text content of specified XML nodes.</p>
<p>The example below shows how regular expressions can be used to replace entire nodes are patterns within nodes.</p>
<p>In order to capture dates and date times within the diagnoses sections, we will construct some regular expressions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a string of valid month abbreviations</span></span>
<span><span class="va">months</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">month.abb</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define regex replacements with specific month abbreviations</span></span>
<span><span class="va">dx_replace</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Replacement for date-time format</span></span>
<span>    <span class="st">"XX-XXX-XXXX XX:XX"</span>,  </span>
<span>    <span class="co"># Replacement for date format</span></span>
<span>    <span class="st">"XX-XXX-XXXX"</span>,     </span>
<span>    <span class="co"># Replacement for confirmation format</span></span>
<span>    <span class="st">"Confirmed by XXX (XX) on XX/XX/XXXX XX:XX:XX XM"</span> </span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\d{2}-("</span>, <span class="va">months</span>, <span class="st">")-\\d{4} \\d{2}:\\d{2}"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"\\d{2}-("</span>, <span class="va">months</span>, <span class="st">")-\\d{4}"</span><span class="op">)</span>,</span>
<span>    <span class="st">"Confirmed by [A-Za-z]+, [A-Za-z]+ \\(\\d+\\) on \\d{1,2}/\\d{1,2}/\\d{4} \\d{1,2}:\\d{2}:\\d{2} [APM]+"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Below, we construct a full list of replacements. <code>".*"</code> is used to replace an entire node.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">replace</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"/RestingECG/PatientDemographics/PatientLastName"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"LastName"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/PatientDemographics/PatientFirstName"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"FirstName"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/PatientDemographics/PatientID"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"PatientID"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/PatientDemographics/DateofBirth"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"XXXX"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/TestDemographics/AcquisitionTime"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"XXXX"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/TestDemographics/AcquisitionDate"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">".*"</span> <span class="op">=</span> <span class="st">"XXXX"</span><span class="op">)</span>,</span>
<span>  <span class="st">"/RestingECG/Diagnosis/DiagnosisStatement/StmtText"</span> <span class="op">=</span> <span class="va">dx_replace</span>,</span>
<span>  <span class="st">"/RestingECG/OriginalDiagnosis/DiagnosisStatement/StmtText"</span> <span class="op">=</span> <span class="va">dx_replace</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Specify the path to your existing XML file and the path for the new de-identified XML file. Then, call <code>muse_deidentify</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/muse_example.html">muse_example</a></span><span class="op">(</span><span class="st">"muse/muse_ecg1.xml"</span><span class="op">)</span></span>
<span><span class="va">output_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".xml"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/muse_deidentify.html">muse_deidentify</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">output_file</span>, <span class="va">replace</span><span class="op">)</span></span></code></pre></div>
<p>We recommend use a file diff viewer to visually inspect some replacements to make sure only the intended changes are being made.</p>
<p>This could be done with the <code>diffviewer</code> R package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">diffviewer</span><span class="fu">::</span><span class="fu"><a href="https://diffviewer.r-lib.org/reference/visual_diff.html" class="external-link">visual_diff</a></span><span class="op">(</span><span class="va">file</span>, <span class="va">output_file</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/diffviewer.png" width="100%"></p>
<p>It could also be done via the <code>diff</code> linux tool:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cmd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"diff -u"</span>, <span class="va">file</span>, <span class="va">output_file</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="va">cmd</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in system(cmd, intern = TRUE): running command 'diff -u</span></span>
<span><span class="co">#&gt; /apps/scratch/RtmpPXPjzJ/temp_libpath2a85bc7140f2a3/musePHI/extdata/muse/muse_ecg1.xml</span></span>
<span><span class="co">#&gt; /apps/scratch/Rtmpqkc0f0/file2a954842343b58.xml' had status 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">res</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- /apps/scratch/RtmpPXPjzJ/temp_libpath2a85bc7140f2a3/musePHI/extdata/muse/muse_ecg1.xml   2024-06-23 17:09:21.546756534 -0500</span></span>
<span><span class="co">#&gt; +++ /apps/scratch/Rtmpqkc0f0/file2a954842343b58.xml  2024-06-23 17:09:29.090755967 -0500</span></span>
<span><span class="co">#&gt; @@ -5,11 +5,11 @@</span></span>
<span><span class="co">#&gt;        &lt;MuseVersion&gt;9.0.9.18167&lt;/MuseVersion&gt;</span></span>
<span><span class="co">#&gt;     &lt;/MuseInfo&gt;</span></span>
<span><span class="co">#&gt;     &lt;PatientDemographics&gt;</span></span>
<span><span class="co">#&gt; -      &lt;PatientID&gt;JAX01234&lt;/PatientID&gt;</span></span>
<span><span class="co">#&gt; +      &lt;PatientID&gt;PatientID&lt;/PatientID&gt;</span></span>
<span><span class="co">#&gt;        &lt;PatientAge&gt;60&lt;/PatientAge&gt;</span></span>
<span><span class="co">#&gt;        &lt;AgeUnits&gt;YEARS&lt;/AgeUnits&gt;</span></span>
<span><span class="co">#&gt;        &lt;Gender&gt;MALE&lt;/Gender&gt;</span></span>
<span><span class="co">#&gt; -      &lt;PatientLastName&gt;TEST 05&lt;/PatientLastName&gt;</span></span>
<span><span class="co">#&gt; +      &lt;PatientLastName&gt;LastName&lt;/PatientLastName&gt;</span></span>
<span><span class="co">#&gt;     &lt;/PatientDemographics&gt;</span></span>
<span><span class="co">#&gt;     &lt;TestDemographics&gt;</span></span>
<span><span class="co">#&gt;        &lt;DataType&gt;RESTING&lt;/DataType&gt;</span></span>
<span><span class="co">#&gt; @@ -21,8 +21,8 @@</span></span>
<span><span class="co">#&gt;        &lt;Priority&gt;NORMAL&lt;/Priority&gt;</span></span>
<span><span class="co">#&gt;        &lt;Location&gt;7&lt;/Location&gt;</span></span>
<span><span class="co">#&gt;        &lt;LocationName&gt;FL Research Location&lt;/LocationName&gt;</span></span>
<span><span class="co">#&gt; -      &lt;AcquisitionTime&gt;13:15:18&lt;/AcquisitionTime&gt;</span></span>
<span><span class="co">#&gt; -      &lt;AcquisitionDate&gt;05-10-2021&lt;/AcquisitionDate&gt;</span></span>
<span><span class="co">#&gt; +      &lt;AcquisitionTime&gt;XXXX&lt;/AcquisitionTime&gt;</span></span>
<span><span class="co">#&gt; +      &lt;AcquisitionDate&gt;XXXX&lt;/AcquisitionDate&gt;</span></span>
<span><span class="co">#&gt;        &lt;CartNumber&gt;56&lt;/CartNumber&gt;</span></span>
<span><span class="co">#&gt;        &lt;AcquisitionSoftwareVersion&gt;010B&lt;/AcquisitionSoftwareVersion&gt;</span></span>
<span><span class="co">#&gt;        &lt;AnalysisSoftwareVersion&gt;241&lt;/AnalysisSoftwareVersion&gt;</span></span>
<span><span class="co">#&gt; @@ -88,7 +88,7 @@</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;        &lt;DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;           &lt;StmtFlag&gt;ENDSLINE&lt;/StmtFlag&gt;</span></span>
<span><span class="co">#&gt; -         &lt;StmtText&gt;10-MAY-2021 14:14,&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt; +         &lt;StmtText&gt;XX-XXX-XXXX XX:XX,&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;        &lt;DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;           &lt;StmtFlag&gt;ENDSLINE&lt;/StmtFlag&gt;</span></span>
<span><span class="co">#&gt; @@ -97,7 +97,7 @@</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;        &lt;DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;           &lt;StmtFlag&gt;ENDSLINE&lt;/StmtFlag&gt;</span></span>
<span><span class="co">#&gt; -         &lt;StmtText&gt;Confirmed by Doe, John (123456) on 05/10/2021 1:15:09 PM&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt; +         &lt;StmtText&gt;Confirmed by XXX (XX) on XX/XX/XXXX XX:XX:XX XM&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;     &lt;/Diagnosis&gt;</span></span>
<span><span class="co">#&gt;     &lt;OriginalDiagnosis&gt;</span></span>
<span><span class="co">#&gt; @@ -130,7 +130,7 @@</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;        &lt;DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;           &lt;StmtFlag&gt;ENDSLINE&lt;/StmtFlag&gt;</span></span>
<span><span class="co">#&gt; -         &lt;StmtText&gt;10-MAY-2021 18:34,&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt; +         &lt;StmtText&gt;XX-XXX-XXXX XX:XX,&lt;/StmtText&gt;</span></span>
<span><span class="co">#&gt;        &lt;/DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;        &lt;DiagnosisStatement&gt;</span></span>
<span><span class="co">#&gt;           &lt;StmtFlag&gt;ENDSLINE&lt;/StmtFlag&gt;</span></span></code></pre></div>
<p><strong>NOTE:</strong> It is recommended to save the de-identified ECG data to a new file to preserve the original data.</p>
</div>
<div class="section level2">
<h2 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h2>
<p>For users working with a large number of XML files, parallelization can significantly speed up the de-identification process. We recommend using the <a href="https://furrr.futureverse.org" class="external-link">furrr</a> package to efficiently parallelize your workload.</p>
<p>To demonstrate this, we will process 10000 XML files sequentially and in parallel using 10 CPUs.</p>
<p>First, create 10000 XML files in a temporary directory:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">path_temp</a></span><span class="op">(</span><span class="st">"xmls"</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/copy.html" class="external-link">file_copy</a></span><span class="op">(</span></span>
<span>    <span class="st">"inst/extdata/muse/muse_ecg1.xml"</span>,</span>
<span>    <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">file_temp</a></span><span class="op">(</span>tmp_dir <span class="op">=</span> <span class="va">dir</span>, ext <span class="op">=</span> <span class="st">".xml"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, create a list of XML files and create their new file paths:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xml_files</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_ls.html" class="external-link">dir_ls</a></span><span class="op">(</span><span class="va">dir</span><span class="op">)</span></span>
<span><span class="va">deidentified_dir</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_temp.html" class="external-link">path_temp</a></span><span class="op">(</span><span class="st">"deidentified_xmls"</span><span class="op">)</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">deidentified_dir</span><span class="op">)</span></span>
<span><span class="va">deidentified_xmls</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">deidentified_dir</span>, <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_file.html" class="external-link">path_file</a></span><span class="op">(</span><span class="va">xml_files</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jabiru/tictoc" class="external-link">tictoc</a></span><span class="op">)</span></span></code></pre></div>
<p>Run <code>muse_deidentify</code> sequentially:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tic</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">xml_files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="reference/muse_deidentify.html">muse_deidentify</a></span><span class="op">(</span><span class="va">xml_files</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">deidentified_xmls</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">replace</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0.464 sec elapsed</span></span></code></pre></div>
<p>Run in parallel:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: future</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tic</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://furrr.futureverse.org/reference/future_map2.html" class="external-link">future_walk2</a></span><span class="op">(</span><span class="va">xml_files</span>, <span class="va">deidentified_xmls</span>, <span class="va">muse_deidentify</span>, replace <span class="op">=</span> <span class="va">replace</span><span class="op">)</span></span>
<span><span class="fu">toc</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 3.32 sec elapsed</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="summarizing-diagnosis-data">Summarizing Diagnosis Data<a class="anchor" aria-label="anchor" href="#summarizing-diagnosis-data"></a>
</h1>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnoses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html" class="external-link">future_map_dfr</a></span><span class="op">(</span><span class="va">deidentified_xmls</span>, <span class="va">muse_diagnoses</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diagnoses</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">value</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 × 2</span></span>
<span><span class="co">#&gt;    value                                                  n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                              &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 ENDSLINE                                            1100</span></span>
<span><span class="co">#&gt;  2 USERINSERT                                           200</span></span>
<span><span class="co">#&gt;  3 When compared with ECG of                            200</span></span>
<span><span class="co">#&gt;  4 XX-XXX-XXXX XX:XX,                                   200</span></span>
<span><span class="co">#&gt;  5 , age undetermined                                   100</span></span>
<span><span class="co">#&gt;  6 Abnormal ECG                                         100</span></span>
<span><span class="co">#&gt;  7 Confirmed by XXX (XX) on XX/XX/XXXX XX:XX:XX XM      100</span></span>
<span><span class="co">#&gt;  8 Lateral infarct                                      100</span></span>
<span><span class="co">#&gt;  9 Left axis deviation                                  100</span></span>
<span><span class="co">#&gt; 10 No significant change.                               100</span></span>
<span><span class="co">#&gt; 11 Non-specific intra-ventricular conduction block      100</span></span>
<span><span class="co">#&gt; 12 Previous ECG has undetermined rhythm, needs review   100</span></span>
<span><span class="co">#&gt; 13 Ventricular-paced rhythm                             100</span></span>
<span><span class="co">#&gt; 14 Wide QRS rhythm                                      100</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/overdodactyl/musePHI/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/overdodactyl/musePHI/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing musePHI</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Pat Johnson <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-8365-1375" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/overdodactyl/musePHI/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/overdodactyl/musePHI/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pat Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
